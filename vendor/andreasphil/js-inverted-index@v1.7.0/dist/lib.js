function g(t,e){if(!t)return;let n=Array.isArray(e)?e:e.split("."),[r,...i]=n;return i.length?g(t[r],i):t[r]}function x(...t){if(!t.length||t.some(d=>!d))return new Set;if(t.length===1)return t[0];let e=[...t],n=e.shift(),r=e.shift(),i=new Set;return n.forEach(d=>{r.has(d)&&i.add(d)}),e.unshift(i),x(...e)}function w(t){return e=>e[t]?.toString?.()}var y=t=>t?.trim().toLowerCase(),z=(t,e,n)=>{if(!e||Object.keys(t).length===0)return new Set;let{tokenizer:r,normalizer:i}=n,m=r(e).map(p=>i(p)).map(p=>t[p]);return x(...m)};function k(t){return e=>e?e.match(t)||[]:[]}var S=k(/\w+/g),O=t=>{let e=S(t),n=new Set;return e.filter(r=>r.length>0).forEach(r=>{for(let i=1;i<=r.length;i++)n.add(r.substring(0,i))}),Array.from(n)};function E(t={}){let e={tokenizer:S,identifier:w("id"),normalizer:y,searcher:z,fields:[],...t},n=Object.create(null),r={};return{search:f=>{let c=[];return e.searcher(n,f,e).forEach(s=>{r[s]&&c.push(r[s])}),c},add:f=>{let{tokenizer:c,identifier:h,normalizer:s,fields:u}=e;f.forEach(a=>{let l=h(a);r[l]=a,u.map(o=>g(a,o)).filter(o=>!!o?.toString).flatMap(o=>c(o.toString())).map(o=>s(o)).forEach(o=>{n[o]?n[o].add(l):n[o]=new Set([l])})})},dump:()=>{let f={};return Object.entries(n).reduce((c,[h,s])=>(c[h]=Array.from(s),c),f)},hydrate:(f,c)=>{let h={},s={};n=Object.entries(f).reduce((u,[a,l])=>(u[a]=new Set(l),u),h),r=c.reduce((u,a)=>(u[e.identifier(a)]=a,u),s)}}}export{E as default,S as fullWordSplit,w as idProp,x as intersect,y as lowercaseTrim,z as matchAllTerms,k as regexSplit,O as startsWith,g as unwrap};
//# sourceMappingURL=lib.js.map
